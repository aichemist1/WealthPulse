{
  auto_https off
}

:80 {
  encode gzip

  # Backend (API)
  handle_path /api/* {
    reverse_proxy backend:8000
  }

  # Backend (public pages used by email-only subscribers)
  handle /health* {
    reverse_proxy backend:8000
  }
  handle /subscribe* {
    reverse_proxy backend:8000
  }
  handle /confirm* {
    reverse_proxy backend:8000
  }
  handle /unsubscribe* {
    reverse_proxy backend:8000
  }

  # Frontend SPA
  root * /srv
  try_files {path} /index.html
  file_server
}

