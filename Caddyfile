{
  auto_https off
}

:80 {
  encode gzip

  route {
    # Backend (API)
    handle /api/* {
      uri strip_prefix /api
      reverse_proxy backend:8000
    }

    # Backend (public pages used by email-only subscribers)
    handle /health* {
      reverse_proxy backend:8000
    }
    handle /subscribe* {
      reverse_proxy backend:8000
    }
    handle /confirm* {
      reverse_proxy backend:8000
    }
    handle /unsubscribe* {
      reverse_proxy backend:8000
    }

    # Frontend SPA (catch-all)
    handle {
      root * /srv
      try_files {path} /index.html
      file_server
    }
  }
}
