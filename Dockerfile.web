FROM node:20-alpine AS build
WORKDIR /src

COPY frontend/package.json frontend/package-lock.json /src/
RUN npm ci

COPY frontend /src

# Serve API behind the same origin: /api/*
ARG VITE_API_BASE_URL=/api
ENV VITE_API_BASE_URL=${VITE_API_BASE_URL}
RUN npm run build

FROM caddy:2-alpine
WORKDIR /srv
COPY --from=build /src/dist /srv
COPY Caddyfile /etc/caddy/Caddyfile

